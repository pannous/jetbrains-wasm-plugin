# WebAssembly GC Feature Test Results

## Test Setup
- Test file: `src/test/resources/parser/file/Gc.wat`
- Test class: `WebAssemblyTestFile.testGc()` in `src/test/kotlin/com/intellij/webassembly/lang/parser/WebAssemblyTestFile.kt`
- Test status: ✅ **PASSING**

## Test Coverage

The test verifies parsing of WebAssembly GC (Garbage Collection) proposal features:

### ✅ Successfully Parsed Features

1. **Struct Types** (lines 91-158 in parse tree)
   - `(type $my-struct (struct ...))`
   - Fields with mutable/immutable types
   - Nested field definitions with `(field i32)` and `(field (mut i64))`

2. **Reference Types** (lines 72-106 in parse tree)
   - `(ref null $my-array)` - nullable references
   - `(ref null $my-struct)` - nullable struct references
   - Local variables with GC reference types

3. **GC Instructions**
   - `array.new` - array creation
   - `array.len` - get array length (no type parameter)
   - `array.get`, `array.set` - array element access
   - `struct.new` - struct creation
   - `struct.get`, `struct.set` - struct field access
   - Proper parsing of instruction operands

4. **Type References**
   - Type identifiers like `$my-array`, `$my-struct`
   - Reference type syntax in local declarations

### ✅ All Parse Errors Fixed!

All GC features now parse correctly without errors:

1. **Array Type Syntax** - ✅ **FIXED**
   ```wat
   (type $my-array (array i32))           ;; Immutable array ✅
   (type $string (array (mut i8)))         ;; Mutable array ✅
   ```
   - Both syntax variants now parse correctly
   - Grammar updated to use choice operator for mut/immut alternatives
   - Test: `testGcMut()` validates both forms

## Test Execution

Tests can be run with:
```bash
# Comprehensive GC features test
./gradlew test --tests "com.intellij.webassembly.lang.parser.WebAssemblyTestFile.testGc"

# Mutable/immutable array types
./gradlew test --tests "com.intellij.webassembly.lang.parser.WebAssemblyTestFile.testGcMut"

# array.len instruction
./gradlew test --tests "com.intellij.webassembly.lang.parser.WebAssemblyTestFile.testArrayLen"

# All parser tests
./gradlew test --tests "com.intellij.webassembly.lang.parser.*"
```

## Parse Tree Location

Full parse tree output: `src/test/resources/parser/file/Gc.txt`

This shows the complete AST (Abstract Syntax Tree) generated by the parser, useful for:
- Verifying correct token recognition
- Debugging parse errors
- Understanding parser structure for IDE features
